<!DOCTYPE html>
<html>
<head>
	{% load staticfiles %}
    <title>Офис</title>
	<meta http-equiv='Content-Type' content = 'text/html; charset=utf-8' />
	<script src="http://yastatic.net/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <script src="http://yastatic.net/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://yastatic.net/bootstrap/3.3.1/css/bootstrap.min.css" />
    <link rel = 'stylesheet' type = 'text/css' href = '{% static "style.css" %}' /> 
    <link rel = 'stylesheet' type = 'text/css' href = '{% static "jquery.tokenize.css" %}' /> 
    <script src= '{% static "script.js" %}'></script>   
    <script src= '{% static "tooltip.js" %}'></script>	
    <script src= '{% static "popover.js" %}'></script>  
    <script src= '{% static "dropdown.js" %}'></script>  
    <script src= '{% static "Chart.js" %}'></script>
    <script type="text/javascript" src = '{% static "jquery.tokenize.js" %}'></script>
    <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.indigo-pink.min.css">
	<script src="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.min.js"></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">	
    <style type="text/css">
        header.mdl-layout__header {
                    background-color: rgb(53, 59, 90);
                    font: black;
                }
        div {
            text-align: center;
        }
        .not_aligned>div {
            text-align: left;
        }

        .planning_upload {
            margin-top: 2%;
        }
        .planning_upload_title {
            margin-bottom: 5px;
            padding-bottom: 5px;
        }
        .bordered_down {
            border-bottom: 1px solid black;
        }
        .bordered_right {
            border-right: 1px solid black;
        }
        .chapter_title {
            padding-bottom: 5px;
        }
        .tokenize-sample {
            width: 100%;
        }
    </style>
    <script type="text/javascript">
    $(document).ready(function() {
        $('#tokenize').tokenize({
            sortable: true,
            displayDropdownOnFocus: true
        });

        $('#plan_unload').click(function(){
            date_of_unload = $('#new_unload_date').val();
            var i = 0;
            data_for_send = {};
            $('li.Token').each(function() {
                //j = i.toString()
                data_for_send[i] = $(this).attr('data-value');
                i = i + 1;
            });
            data_for_send.date_of_unload = date_of_unload;

            console.log(data_for_send);

            $.ajax({
                type: 'GET',
                data: data_for_send,
                url: "{% url 'control_measure:plan_new_unload' %}",
                success: function() {
                    console.log('new planned is made up successfully');
                },
                error: function() {
                    console.log('new planned was made with errors');
                }
            });
            window.location.href = "{% url 'control_measure:office' %}";
        });

        $('.cancel_button').click(function() {
            unload_id = ($(this).attr('id')).substring(7);
            $.ajax({
                type: 'GET',
                data: {'id': unload_id },
                url: "{% url 'control_measure:cancel_planned_unload' %}"
            });
            window.location.reload();
        });
    });
    
    </script>
</head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <!-- Title -->
          <span class="mdl-layout-title"> <a href="/" style = "color: white; text-decoration: none;"> Znaik 1.5 </a> </span>
          <!-- Add spacer, to align navigation to the right -->
          <div class="mdl-layout-spacer"></div>
          <!-- Navigation. We hide it in small screens. -->
          <nav class="mdl-navigation mdl-layout--large-screen-only">
            <a class="mdl-navigation__link" href="/">Город</a>
            <a class="mdl-navigation__link" href="/office">Офис</a>
            <a class="mdl-navigation__link" href="/warehouse">Склад</a>
            <a class="mdl-navigation__link logout" href="">Выйти</a>
          </nav>
        </div>
      </header>
      <div class="container">
          <div class="row planning_upload">
              <div class="col-xs-7 bordered_right">
                <div class="row planning_upload_title bordered_down">Контейнеры</div>
                {% if waiting_bins_list %}
                <div class="row not_aligned bordered_down chapter_title">
                    <div class="col-xs-1"> #</div>
                    <div class="col-xs-4">Адрес</div>
                    <div class="col-xs-2">Fill</div>
                    <div class="col-xs-1">Темп</div>
                    <div class="col-xs-3">Вывоз</div>
                </div>
                {% endif %}
                {% for bin in waiting_bins_list %}
                    <div class="row not_aligned">
                        <div class="col-xs-1">{{ forloop.counter }}</div>
                        <div class="col-xs-4">{{ bin.bin_adress }}</div>
                        <div class="col-xs-2">{{ bin.bin_get_current_fill_percentage }}%</div>
                        <div class="col-xs-1">{{ bin.bin_get_average_pace_per_day_output }}%</div>
                        <div class="col-xs-3">{{ bin.bin_get_upload_date }} </div>
                    </div>
                {% endfor %}
              </div>
              <div class="col-xs-5">
                <div class="row planning_upload_title bordered_down">Запланировать вывоз</div>
                <div class="row not_aligned bordered_down chapter_title">
                    <div class="col-xs-4">Дата</div>
                    <div class="col-xs-8">Контейнеры</div> 
                </div>
                {% if unload_list %}
                    {% for unload in unload_list %}
                    <div class="row not_aligned ">
                        <div class="col-xs-3">{{ unload.unload_date.date }}</div>
                        {% for a_bin in unload.unload_get_bins %}
                            <div class="col-xs-2">{{ a_bin.bin_adress }}</div> 
                        {% endfor %}
                    </div>
                    <div class="row">
                        <button id = "cancel_{{unload.unload_id}}" class = "cancel_button">Отменить</button>
                    </div> 
                    {% endfor %}
                {% else %}
                    <div>Нет запланированных вывозов, создайте первый, заполнив форму ниже</div>
                {% endif %}
                <div class="row not_aligned">
                    <div class="col-xs-4">
                        <input type = "text" id="new_unload_date" placeholder = "YYYY-MM-DD"/>
                    </div>
                    <div class="col-xs-6">
                        <select id="tokenize" multiple="multiple" class="tokenize-sample" placeholder = "Выберите контейнеры">
                        {% for bin in waiting_bins_list %}
                            <option value = "{{ bin.bin_adress }}">{{ bin.bin_adress }} </option>
                        {% endfor %}
                        </select>
                    </div>
                    <div class="col-xs-1">
                        <button id="plan_unload">Запланировать</button>
                    </div>
                </div>
                </div>
              </div>
          </div>
      </div>
    </div>
</body>